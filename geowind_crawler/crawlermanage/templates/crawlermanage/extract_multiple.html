{% extends "crawlermanage/index.html" %}
{% block head %}
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>爬虫后台管理系统</title>
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.6 -->
  <link rel="stylesheet" href="../../static/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="../../static/style/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="../../static/plugins/iCheck/flat/blue.css">
  <link rel="stylesheet" href="../../static/plugins/datatables/dataTables.bootstrap.css">
  <link rel="stylesheet" href="../../static/plugins/daterangepicker/daterangepicker.css">
  <link rel="stylesheet" href="../../static/plugins/select2/select2.min.css">
  <link rel="stylesheet" href="../../static/dist/css/AdminLTE.min.css">
  <link rel="stylesheet" href="../../static/dist/css/skins/_all-skins.min.css">
  <!-- <link rel="stylesheet" href="../../static/plugins/iCheck/all.css"> -->

</head>
{% endblock %}
{% block sidebar %}
      <ul class="sidebar-menu">
        <li class="header">主控面板</li>
        <li>
          <a href="{% url 'tasks' %}">
            <i class="fa fa-dashboard"></i> <span>爬虫状态</span>
          </a>
        </li>
        <li class="active">
          <a href="{%url 'layout'%}">
            <i class="fa fa-tasks"></i> <span>布置任务</span>
          </a>
        </li>
          <li>
          <a href="{% url 'machinelist' %}">
            <i class="fa fa-medium"></i> <span>从机管理</span>
          </a>
        </li>
        <li>
          <a href="{% url 'processlist' %}">
            <i class="fa fa-th-large"></i> <span>进程管理</span>
          </a>
        </li>
        <li class="treeview active">
          <a href="#">
            <i class="fa fa-sort-alpha-asc"></i> <span>自动结构</span>
            <span class="pull-right-container">
              <i class="fa fa-angle-left pull-right"></i>
            </span>
          </a>
          <ul class="treeview-menu">
            <li><a href="{%url 'extractsinger' %}"><i class="fa fa-circle-o"></i>正文抽取</a></li>
            <li class="active"><a href="{%url 'extractmultiple' %}"><i class="fa fa-circle-o"></i>批量抽取</a></li>
          </ul>
        </li>
        <li class="treeview">
          <a href="#">
            <i class="fa fa-map-o"></i> <span>正文测试</span>
            <span class="pull-right-container">
              <i class="fa fa-angle-left pull-right"></i>
            </span>
          </a>
          <ul class="treeview-menu">
            <li><a href="{%url 'extractarticle' %}"><i class="fa fa-circle-o"></i>批量抽取</a></li>
            <li><a href="{%url 'testarticles' %}"><i class="fa fa-circle-o"></i>批量测试</a></li>
            <li><a href="{%url 'testsingle' %}"><i class="fa fa-circle-o"></i>单例测试</a ></li>
          </ul>
        </li>
        <li>
          <a href="{% url 'charts' %}">
            <i class="fa fa-pie-chart"></i> <span>数据统计</span>
          </a>
        </li>
        <li>
          <a href="{% url 'introduce'%}">
            <i class="fa fa-book"></i> <span>使用说明</span>
          </a>
        </li>

        <li>
          <a href="pages/widgets.html">
            <i class="fa fa-share"></i> <span>联系我们</span>
          </a>
        </li>
      </ul>
{% endblock %}
{% block maincontent %}
<div class="box box-primary">
          <div class="box-header with-border">
            <h3 class="box-title">输入一批具有相同模板的URL集合，自动提取数据</h3>
          </div>
          <!-- /.box-header -->
          <div class="box-body">
            <!--<form action="/crawlermanage/layout/" method="post" role="form">{% csrf_token %}-->
              <!-- text input -->
              <div class="form-group">
                <label>起始URL（如有多个用","分割）</label>
                <textarea id="starturls" class="form-control" rows="3" placeholder="例如：https://www.geowind.com,http://www.bootstrap.com"></textarea>
                
              </div>

              <!-- select -->
              <div class="form-group">
                <label>网站类型</label>
                <select class="form-control" id="webtype">
                  <option value="article">新闻/博客</option>
                  <option value="ecommerce">电商</option>
                </select>
              </div>

              </div>
              <div class="box-footer">
                <button id="submit" type="button" class="btn btn-primary pull-right">确认</button>
              </div>
            <!--</form>-->
          </div>
          <!-- /.box-body -->
          <div class="box">
              <div class="modal-header">
                <h4 class="box-title">测试结果(点击链接查看详情)</h4>
              </div>
              <div class="box-body">
                  <ul id="urls" style="list-style: none;">
                    
                  </ul>
              </div>
              <div id="test_loading" class="overlay" style="display:none;">
                  <i class="fa fa-refresh fa-spin"></i>
              </div>
            </div><!-- /.modal-content -->
        </div>
        <div class="box-body">
        </div>
{% endblock %}
{% block script %}
<script src="../../static/plugins/jQuery/jquery-2.2.3.min.js"></script>
<script src="../../static/bootstrap/js/bootstrap.min.js"></script>
<script src="../../static/dist/js/app.min.js"></script>
<script src="../../static/dist/js/demo.js"></script>
<script>

  $("#submit").click(function() {
    starturls = $('#starturls').val()
    webtype = $('#webtype').val()
    if(webtype=='' || starturls=='') {
      alert('请完善信息...')
      return
    }
    $('#test_loading').css('display','');
    $.post('/crawlermanage/extractmultiple/', {
      starturls:starturls,
      webtype:webtype,
    }, function(data) {
      if(data!=null){
        $('#urls').html('')
        //alert(data['webtype'])
        if(data['webtype']=='article') {
          //alert(data['urls'])
          urls = data['urls'].toString()
          var url_list = urls.split(',')
          var url_list_len = url_list.length
          
          id_list = data['ids'].toString().split(',')
          id_len = id_list.length;

          for(var i=0; i<url_list_len; i++) {
            $('#urls').append("<li><a style='cursor:pointer;' target='blank' href='{%url 'temparticle'%}?id="+id_list[i]+"'>"+url_list[i]+"<a></li>")
          }

          $('#test_loading').css('display','none');
            
        }
      }
    }, 'json')
  });
</script>
{% endblock %}