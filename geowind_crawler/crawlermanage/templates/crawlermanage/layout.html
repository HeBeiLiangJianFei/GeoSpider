{% extends "crawlermanage/index.html" %}
{% block head %}
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>爬虫后台管理系统</title>
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.6 -->
  <link rel="stylesheet" href="../../static/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="../../static/style/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="../../static/plugins/iCheck/flat/blue.css">
  <link rel="stylesheet" href="../../static/plugins/datatables/dataTables.bootstrap.css">
  <link rel="stylesheet" href="../../static/plugins/daterangepicker/daterangepicker.css">
  <link rel="stylesheet" href="../../static/plugins/select2/select2.min.css">
  <link rel="stylesheet" href="../../static/dist/css/AdminLTE.min.css">
  <link rel="stylesheet" href="../../static/dist/css/skins/_all-skins.min.css">
  <!-- <link rel="stylesheet" href="../../static/plugins/iCheck/all.css"> -->

</head>
{% endblock %}
{% block maincontent %}
<div class="box box-primary">
          <div class="box-header with-border">
            <h3 class="box-title">通用任务设置</h3>
          </div>
          <!-- /.box-header -->
          <div class="box-body">
            <!--<form action="/crawlermanage/layout/" method="post" role="form">{% csrf_token %}-->
              <!-- text input -->
              <div class="form-group">
                <label>任务名</label>
                <input id="taskname" type="text" class="form-control" placeholder="输入任务名 ...">
                <!-- {% if error1 %}
                  <p style="color: red;">{{error1}}</p>
                {% endif %} -->
              </div>
              <!-- textarea -->
              <div class="form-group">
                <label>起始URL（如有多个用","分割）</label>
                <textarea id="starturls" class="form-control" rows="3" placeholder="例如：https://www.geowind.com,http://www.bootstrap.com"></textarea>
                <!-- {% if error2 %}
                  <p style="color: red;">{{error2}}</p>
                {% endif %} -->
              </div>

              <div class="form-group">
                <label>任务描述</label>
                <textarea id="describe" class="form-control" rows="3" placeholder="点击输入"></textarea>
                  <p style="color: red;">{{error2}}</p>
              </div>

              <!-- select -->
              <div class="form-group">
                <label>网站类型</label>
                <select class="form-control" id="webtype">
                  <option value="ecommerce">电商网站</option>
                  <option value="news">新闻</option>
                  <option value="blog">博客</option>
                </select>
              </div>

              <!-- radio -->
              <!--<div class="form-group">-->
                <!--<label>运行模式</label>-->
                <!--<div class="radio">-->
                  <!--<label>-->
                    <!--<input type="radio" name="runmodel" id="optionsRadios1" value="option1" checked>-->
                    <!--均衡模式&mdash;默认模式运行，消耗内存比较小-->
                  <!--</label>-->
                <!--</div>-->
                <!--<div class="radio">-->
                  <!--<label>-->
                    <!--<input type="radio" name="runmodel" id="optionsRadios2" value="option2">-->
                    <!--进程最大&mdash;启动额定的最大进程数，速度快，但内存消耗大-->
                  <!--</label>-->
                <!--</div>-->
                <!--<div class="radio">-->
                  <!--<label>-->
                    <!--<input type="radio" name="runmodel" id="optionsRadios3" value="option3" disabled>-->
                    <!--还在思考-->
                  <!--</label>-->
                <!--</div>-->
              <!--</div>-->

              <!-- 下拉列表：高级设置 -->
              <label class="collapsed" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne"> 高级参数（点击设置）</label>
              <div class="form-group">
                <!-- <button type="button" class="btn btn-default collapsed" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne"> -->
                <!-- <label>高级参数</label> -->
                <!-- <i class="glyphicon glyphicon-plus"></i> -->
              <!-- </button> -->

              <div id="collapseOne" class="accordion-body collapse" aria-expanded="false" style="height: 0px;">
                <div class="accordion-inner">
                    <table class="table table-bordered table-striped">
                  <tbody>
                    <tr>
                      <th><label>运行时间区间</label></th>
                      <td>
                          <div class="form-group">
                            <div class="input-group">
                              <div class="input-group-addon">
                                <i class="fa fa-clock-o"></i>
                              </div>
                              <!--<input type="text" class="form-control pull-right" id="reservationtime">-->
                              <input id="reservationtime" class="form-control pull-right" class="daterangepicker-field"></input>
                            </div>
                            <!-- /.input group -->
                          </div>
                      </td>
                    </tr>
                    <tr>
                      <th><label>优先抓取（视网站类型变化）</label></th>
                      <td>
                        <div class="form-group">
                          <select class="form-control select2" multiple="multiple" data-placeholder="默认均衡抓取" style="width: 100%;">
                            <option>商品优先</option>
                            <option>评论优先</option>
                            <option>店铺优先</option>
                          </select>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <th><label>分布式主机</label></th>
                      <td>
                        <div class="form-group">
                          <select class="form-control select2" multiple="multiple" data-placeholder="以下主机可用" id="slave" style="width: 100%;">
                            <option value="192.168.1.114">linux 115.123.123.33</option>
                            <option value="192.168.1.130">代号xxx</option>
                            <option>代号666</option>
                          </select>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
                </div>
              </div>

              </div>

              <div class="box-footer">
                <button type="button" class="btn btn-default">取消</button>
                <button id="submit" type="button" class="btn btn-primary pull-right">确认</button>
              </div>
            <!--</form>-->
          </div>
          <!-- /.box-body -->
        </div>
        <div class="box-body">
        </div>
{% endblock %}
{% block script %}
<script src="../../static/plugins/jQuery/jquery-2.2.3.min.js"></script>
<script src="../../static/bootstrap/js/bootstrap.min.js"></script>
<script src="../../static/dist/js/app.min.js"></script>
<script src="../../static/dist/js/demo.js"></script>

<script src="../../static/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="../../static/plugins/datatables/dataTables.bootstrap.min.js"></script>
<script src="../../static/plugins/select2/select2.full.min.js"></script>

<script src="../../static/plugins/bootstrap3-editable/js/moment.js"></script>
<script src="../../static/plugins/daterangepicker/daterangepicker.js"></script>
<script>
  $(function () {
    // $("#example1").DataTable();
    $('#example1').DataTable({
      "paging": true,
      "lengthChange": false,
      "searching": false,
      "ordering": false,
      "info": true,
      "autoWidth": false
    });

    $(".select2").select2();
    // $('#reservationtime').daterangepicker({
    //   forceUpdate: true,
    //   callback: function(startDate, endDate, period){
    //     var title = startDate.format('L') + ' – ' + endDate.format('L');
    //     $(this).val(title)
    //   }
    // });
    
    $('#reservationtime').daterangepicker({
        timePicker: true,
        timePickerIncrement: 1,
        timePicker24Hour: true,
        locale: {
            format: 'YYYY/MM/DD HH:mm',
            cancelLabel: 'Clear'
        },
        autoUpdateInput: false
    });
    $('#reservationtime').on('apply.daterangepicker', function(ev, picker) {
      $(this).val(picker.startDate.format('YYYY/MM/DD HH:mm') + ' - ' + picker.endDate.format('YYYY/MM/DD HH:mm'));
    });

    $('#reservationtime').on('cancel.daterangepicker', function(ev, picker) {
      $(this).val('');
    });


  });

  $("#submit").click(function() {
    taskname = $('#taskname').val()
    starturls = $('#starturls').val()
    describe = $('#describe').val()
    webtype = $('#webtype').val()
    reservationtime = $('#reservationtime').val()
    slave = $('#slave').val()
    if(taskname=='' || starturls=='') {
      alert('请完善信息...')
      return
    }
    if(slave!=null) {
      slave = slave.toString()
    }
    $.post('/crawlermanage/layout/', {
      taskname:taskname,
      starturls:starturls,
      describe:describe,
      webtype:webtype,
      reservationtime:reservationtime,
      slave:slave
    }, function(data) {
      if(data!=null){
        if (data['status']=='success') {
          location.href = '/crawlermanage/tasks'
        }
        
      }
    }, 'json')
  });
</script>
{% endblock %}